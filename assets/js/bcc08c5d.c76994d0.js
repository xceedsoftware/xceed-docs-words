"use strict";(self.webpackChunkxceed_libs_doc=self.webpackChunkxceed_libs_doc||[]).push([[9459],{75589:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>m});var s=t(74848),n=t(28453),a=t(11470),o=t(19365);const i={title:"Compressing a stream"},l="Compressing stream data",c={id:"code-snippets/memory-compression/compressing-stream",title:"Compressing a stream",description:"This topic demonstrates how to compress data that is read from a FileStream to a MemoryStream using the XceedCompressedStream class.",source:"@site/zip/code-snippets/memory-compression/compressing-stream.md",sourceDirName:"code-snippets/memory-compression",slug:"/code-snippets/memory-compression/compressing-stream",permalink:"/xceed-libs-doc/zip/code-snippets/memory-compression/compressing-stream",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Compressing a stream"},sidebar:"sidebarzip",previous:{title:"Memory compression",permalink:"/xceed-libs-doc/zip/category/memory-compression"},next:{title:"Compressing a memory buffer (QuickCompression)",permalink:"/xceed-libs-doc/zip/code-snippets/memory-compression/compressing-memory-buffer"}},d={},m=[{value:"Basic steps",id:"basic-steps",level:2},{value:"Example",id:"example",level:2},{value:"Things you should consider",id:"things-you-should-consider",level:2}];function p(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"compressing-stream-data",children:"Compressing stream data"})}),"\n",(0,s.jsxs)(r.p,{children:["This topic demonstrates how to compress data that is read from a ",(0,s.jsx)(r.code,{children:"FileStream"})," to a ",(0,s.jsx)(r.code,{children:"MemoryStream"})," using the ",(0,s.jsx)(r.code,{children:"XceedCompressedStream"})," class."]}),"\n",(0,s.jsx)(r.p,{children:"Although we are using a FileStream as our source and a MemoryStream as our destination, we could have also used any other type of stream. For example, we could have compressed data read from a MemoryStream to another MemoryStream or to a FileStream."}),"\n",(0,s.jsx)(r.h2,{id:"basic-steps",children:"Basic steps"}),"\n",(0,s.jsx)(r.p,{children:"To copy items to a zip file, the following steps must be performed:"}),"\n",(0,s.jsx)(r.p,{children:"1- Create the source stream from which the data will be read. For the purposes of this example, our source stream will be a FileStream. But it can be any Stream object from any source as long as data can be read from it. No 'seek' or 'write' capabilities are needed."}),"\n",(0,s.jsx)(r.p,{children:"2- Create the destination stream to which the compressed data will be written. For the purposes of this example, our destination stream will be a MemoryStream. It can be any Stream object for any destination as long as data can be written to it. No 'seek' or 'read' capabilities are needed."}),"\n",(0,s.jsx)(r.p,{children:"3- Create a compressed stream object around the destination stream. For the purposes of this example we used the XceedCompressedStream class. However, we could have also used the GZipCompressedStream or the ZLibCompressedStream classes interchangibly. All the classes work the same. Only the parameters to the constructors change."}),"\n",(0,s.jsx)(r.p,{children:"4- Read the uncompressed data from the source stream."}),"\n",(0,s.jsx)(r.p,{children:"5- Write the data to the compressed stream object. Writing to the object compresses the data and, in turn, writes the compressed data to the destination stream."}),"\n",(0,s.jsx)(r.h2,{id:"example",children:"Example"}),"\n",(0,s.jsx)(r.p,{children:"The following example demonstrates how to read data from a FileStream and compress it to a MemoryStream using the XceedCompressedStream class."}),"\n",(0,s.jsxs)(a.A,{children:[(0,s.jsx)(o.A,{value:"csharp",label:"C#",default:!0,children:(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"  using System.IO;\r\n\r\n  using Xceed.Compression;\r\n  using Xceed.Compression.Formats;\r\n\r\n  namespace FileSystemDocumentationExamples.CompressionComponent\r\n  {\r\n    public class CompressXceedCompressedStreamExample\r\n    {\r\n      public void MyMainMethod()\r\n      {\r\n        /* Because Xceed.Compression.Formats is an optional assembly not automatically\r\n          unlocked by Xceed Zip for .NET, we must explicitly set our license key to it\r\n          before use or else an exception will be thrown. */\r\n        Xceed.Compression.Formats.Licenser.LicenseKey = \"<your Xceed Zip for .NET license key>\";\r\n      }\r\n\r\n      public void Example()\r\n      {\r\n        /* Setup a destination data stream. This can be any Stream object for any destination as\r\n          long as data can be written to it. No 'seek' or 'read' capabilities are needed. */\r\n        MemoryStream destinationStream = new MemoryStream();\r\n\r\n        /* Setup a source data stream. This can be any Stream object from any source as\r\n          long as data can be read from it. No 'seek' or 'write' capabilities are needed. */\r\n        using( FileStream sourceStream = new FileStream( @\"D:\\data.txt\", FileMode.Open, FileAccess.Read, FileShare.Read ) )\r\n        {\r\n          /* Optional: the compression method and level can be specified. */\r\n          CompressionMethod compressionMethod = CompressionMethod.Deflated;\r\n          CompressionLevel compressionLevel = CompressionLevel.Normal;\r\n          string password = String.Empty;\r\n\r\n          // Optional: the data will be encrypted if a non-empty password is specified\r\n          //password = \"password\";\r\n\r\n          // Create a XceedCompressedStream that wraps around our destination stream\r\n          using( XceedCompressedStream xceedCompressedStream = new XceedCompressedStream( destinationStream, compressionMethod, compressionLevel, false, password ) )\r\n          {\r\n            /* The XceedCompressedStream automatically closes the destination\r\n              memory stream. So there is no need to declare the memory stream within a using\r\n              statement or to call Close() once we are done with the stream.\r\n              \r\n              If you do not want the inner stream to be closed by the XceedCompressedStream,\r\n              set its Transient property to true. */\r\n\r\n            // Optional: Prevent XceedCompressedStream from closing 'destinationStream' automatically\r\n            //xceedCompressedStream.Transient = true;\r\n\r\n            int bytesRead;\r\n\r\n            // Setup a 32K buffer\r\n            byte[] buffer = new byte[ 32 * 1024 ];\r\n\r\n            // Read from the source stream until there is no more data\r\n            while( ( bytesRead = sourceStream.Read( buffer, 0, buffer.Length ) ) > 0 )\r\n            {\r\n              // Compress the data by writing into the compressed stream\r\n              // Compressed data will be written into its InnerStream, in our case, 'destinationStream'\r\n              xceedCompressedStream.Write( buffer, 0, bytesRead );\r\n            }\r\n          }\r\n        }\r\n\r\n        /* Optional: The MemoryStream's compressed data can be copied to a byte array, you can use\r\n          MemoryStream.ToArray(). The method works even when the memory stream has been closed. */\r\n        //byte[] compressedData = destinationStream.ToArray();\r\n      }\r\n    }\r\n  }\n"})})}),(0,s.jsx)(o.A,{value:"vb.net",label:"Visual Basic .NET",children:(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-vb.NET",children:"Imports System.IO\r\n\r\nImports Xceed.Compression\r\nImports Xceed.Compression.Formats\r\n\r\nNamespace FileSystemDocumentationExamples.CompressionComponent\r\n  Public Class CompressXceedCompressedStreamExample\r\n    Public Sub MyMainMethod()\r\n'       Because Xceed.Compression.Formats is an optional assembly not automatically\r\n'         unlocked by Xceed Zip for .NET, we must explicitly set our license key to it\r\n'         before use or else an exception will be thrown. \r\n      Xceed.Compression.Formats.Licenser.LicenseKey = \"<your Xceed Zip for .NET license key>\"\r\n    End Sub\r\n\r\n    Public Sub Example()\r\n'       Setup a destination data stream. This can be any Stream object for any destination as\r\n'         long as data can be written to it. No 'seek' or 'read' capabilities are needed. \r\n      Dim destinationStream As New MemoryStream()\r\n\r\n'       Setup a source data stream. This can be any Stream object from any source as\r\n'         long as data can be read from it. No 'seek' or 'write' capabilities are needed. \r\n      Using sourceStream As New FileStream(\"D:\\data.txt\", FileMode.Open, FileAccess.Read, FileShare.Read)\r\n        ' Optional: the compression method and level can be specified. \r\n        Dim compressionMethod As CompressionMethod = CompressionMethod.Deflated\r\n        Dim compressionLevel As CompressionLevel = CompressionLevel.Normal\r\n        Dim password As String = String.Empty\r\n\r\n        ' Optional: the data will be encrypted if a non-empty password is specified\r\n        'password = \"password\";\r\n\r\n        ' Create a XceedCompressedStream that wraps around our destination stream\r\n        Using xceedCompressedStream As New XceedCompressedStream(destinationStream, compressionMethod, compressionLevel, False, password)\r\n'           The XceedCompressedStream automatically closes the destination\r\n'             memory stream. So there is no need to declare the memory stream within a using\r\n'             statement or to call Close() once we are done with the stream.\r\n'            \r\n'             If you do not want the inner stream to be closed by the XceedCompressedStream,\r\n'             set its Transient property to true. \r\n\r\n          ' Optional: Prevent XceedCompressedStream from closing 'destinationStream' automatically\r\n          'xceedCompressedStream.Transient = true;\r\n\r\n          Dim bytesRead As Integer\r\n\r\n          ' Setup a 32K buffer\r\n          Dim buffer(32 * 1024 - 1) As Byte\r\n\r\n          ' Read from the source stream until there is no more data\r\n          bytesRead = sourceStream.Read(buffer, 0, buffer.Length)\r\n          Do While bytesRead > 0\r\n            ' Compress the data by writing into the compressed stream\r\n            ' Compressed data will be written into its InnerStream, in our case, 'destinationStream'\r\n            xceedCompressedStream.Write(buffer, 0, bytesRead)\r\n            bytesRead = sourceStream.Read(buffer, 0, buffer.Length)\r\n          Loop\r\n        End Using\r\n      End Using\r\n\r\n'       Optional: The MemoryStream's compressed data can be copied to a byte array, you can use\r\n'         MemoryStream.ToArray(). The method works even when the memory stream has been closed. \r\n      'byte[] compressedData = destinationStream.ToArray();\r\n    End Sub\r\n  End Class\r\nEnd Namespace\n"})})})]}),"\n",(0,s.jsx)(r.h2,{id:"things-you-should-consider",children:"Things you should consider"}),"\n",(0,s.jsx)(r.p,{children:"The main questions you should ask yourself when copying items to a zip file are:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Do you want to copy a file rather than a folder or its contents? Create a DiskFile class rather than a ",(0,s.jsx)(r.code,{children:"DiskFolder"})," class."]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Do you want to filter (specify specific files and folders) the items that are to be added to the zip file? Use ",(0,s.jsx)(r.code,{children:"filters"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Do you want to add items into a specific folder within the zip file? Create an instance of a ",(0,s.jsx)(r.code,{children:"ZippedFolder"})," object rather than a ",(0,s.jsx)(r.code,{children:"ZipArchive"})," object."]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Do you only want to copy a specific file or folder? Use the ",(0,s.jsx)(r.code,{children:"CopyTo"})," method."]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Do you want to move items rather than copy them? Use the ",(0,s.jsx)(r.code,{children:"MoveTo"})," and ",(0,s.jsx)(r.code,{children:"MoveFilesTo"})," methods."]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Do you want to change the location of the temporary folder. Set the ZipArchive's ",(0,s.jsx)(r.code,{children:"TempFolder"})," or ",(0,s.jsx)(r.code,{children:"DefaultTempFolder"})," property."]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Do you only want to do basic zip file operations? Use the ",(0,s.jsx)(r.a,{href:"/zip/basic-concepts/quick-zip",children:"QuickZip"})," class."]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Do you want to modify the default extra headers that are stored to a zip file? Set the ZipArchive's ",(0,s.jsx)(r.code,{children:"DefaultExtraHeaders"})," property."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsxs)(r.strong,{children:["All zip files will automatically be created in the ",(0,s.jsx)(r.a,{href:"/zip/basic-concepts/zip64-zip-file-format",children:"Zip64 zip file format"})," if the limitations of the regular Zip format are reached."]})})]})}function u(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},19365:(e,r,t)=>{t.d(r,{A:()=>o});t(96540);var s=t(34164);const n={tabItem:"tabItem_Ymn6"};var a=t(74848);function o(e){let{children:r,hidden:t,className:o}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(n.tabItem,o),hidden:t,children:r})}},11470:(e,r,t)=>{t.d(r,{A:()=>v});var s=t(96540),n=t(34164),a=t(23104),o=t(56347),i=t(205),l=t(57485),c=t(31682),d=t(70679);function m(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:r}=e;return!!r&&"object"==typeof r&&"value"in r}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:r,children:t}=e;return(0,s.useMemo)((()=>{const e=r??function(e){return m(e).map((e=>{let{props:{value:r,label:t,attributes:s,default:n}}=e;return{value:r,label:t,attributes:s,default:n}}))}(t);return function(e){const r=(0,c.XI)(e,((e,r)=>e.value===r.value));if(r.length>0)throw new Error(`Docusaurus error: Duplicate values "${r.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[r,t])}function u(e){let{value:r,tabValues:t}=e;return t.some((e=>e.value===r))}function h(e){let{queryString:r=!1,groupId:t}=e;const n=(0,o.W6)(),a=function(e){let{queryString:r=!1,groupId:t}=e;if("string"==typeof r)return r;if(!1===r)return null;if(!0===r&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:r,groupId:t});return[(0,l.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const r=new URLSearchParams(n.location.search);r.set(a,e),n.replace({...n.location,search:r.toString()})}),[a,n])]}function f(e){const{defaultValue:r,queryString:t=!1,groupId:n}=e,a=p(e),[o,l]=(0,s.useState)((()=>function(e){let{defaultValue:r,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(r){if(!u({value:r,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${r}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return r}const s=t.find((e=>e.default))??t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:r,tabValues:a}))),[c,m]=h({queryString:t,groupId:n}),[f,b]=function(e){let{groupId:r}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(r),[n,a]=(0,d.Dv)(t);return[n,(0,s.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:n}),y=(()=>{const e=c??f;return u({value:e,tabValues:a})?e:null})();(0,i.A)((()=>{y&&l(y)}),[y]);return{selectedValue:o,selectValue:(0,s.useCallback)((e=>{if(!u({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),m(e),b(e)}),[m,b,a]),tabValues:a}}var b=t(92303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(74848);function w(e){let{className:r,block:t,selectedValue:s,selectValue:o,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const r=e.currentTarget,t=l.indexOf(r),n=i[t].value;n!==s&&(c(r),o(n))},m=e=>{let r=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;r=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;r=l[t]??l[l.length-1];break}}r?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":t},r),children:i.map((e=>{let{value:r,label:t,attributes:a}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:s===r?0:-1,"aria-selected":s===r,ref:e=>l.push(e),onKeyDown:m,onClick:d,...a,className:(0,n.A)("tabs__item",y.tabItem,a?.className,{"tabs__item--active":s===r}),children:t??r},r)}))})}function S(e){let{lazy:r,children:t,selectedValue:a}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(r){const e=o.find((e=>e.props.value===a));return e?(0,s.cloneElement)(e,{className:(0,n.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:o.map(((e,r)=>(0,s.cloneElement)(e,{key:r,hidden:e.props.value!==a})))})}function g(e){const r=f(e);return(0,x.jsxs)("div",{className:(0,n.A)("tabs-container",y.tabList),children:[(0,x.jsx)(w,{...r,...e}),(0,x.jsx)(S,{...r,...e})]})}function v(e){const r=(0,b.A)();return(0,x.jsx)(g,{...e,children:m(e.children)},String(r))}},28453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>i});var s=t(96540);const n={},a=s.createContext(n);function o(e){const r=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(a.Provider,{value:r},e.children)}}}]);